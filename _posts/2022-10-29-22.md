---
actor_ids:
  - kirameister
audio_file_path: 
audio_file_size: 0
date: 2022-10-29 00:00:00 +0100
description: mozc にて新下駄配列を実現する方法
duration: "00:00"
layout: article
title: 22 - mozc-Shingeta Einstellungen -- 新下駄配列を mozc にて使用する方法
---

1. 前提として Version 4450 以上の mozc が必要。mozc バージョンは、「ばーじょん」の変換候補に出てくる。
1.1. もし Version 4450 未満の mozc を使用しているのであれば、[mozc の README に書かれている内容](https://github.com/google/mozc#build-instructions) に従いローカル環境でビルドする必要あり。
2. Linux 環境では `HOME/.mozc` 以下に `config1.db` というバイナリファイルが存在するが、このファイルを編集することで新下駄配列を実現できる。具体的には以下のような流れになる (特にこの流れに従う必要はない)。
2.1. `protoc` という上記のバイナリファイルを変換するコマンドをインストールする。Debian/Ubuntu ベースの環境では `protobuf-compiler` というパッケージに含まれている。因みにこのバイナリファイルはプラットフォーム非依存なので、一旦自分好みの設定を作成してしまえば、他の環境にある mozc でも (バージョン 4450 以上であれば) 使うことができるはず (私の方では未確認)。
2.2. [`mozc` | `Tools` | `Properties`] を選択して、ローマ字テーブルをカスタマイズする。以下に例を示す (ローマ字テーブルをエクスポートした TSV ファイルの抜粋):
```
q		ー
ー{!}	ー
w		に
に{!}	に
e		は
は{!}	は
...
d		か
か{!}	か
k		い
い{!}	い
...
かk	れ
いd	れ
```
2.3. 上記のローマ字テーブルで重要なのは:
2.3.1. 単打のキー入力がされた段階では「送り (pending)」に出力を入れる。
2.3.2. `送りにて出力された文字` + `{!}` を入力に、その出力に件の文字だけが入ったエントリーを作成する。
2.3.3. 同時打鍵は上記の `送りにて出力された文字` + `同時打鍵のもうひとつのキー` のコンビネーションにより実現される。
2.4. 一連のローマ字テーブルの編集が終わったところで、[OK] ボタンを押下して `config1.db` に上記の内容を保存する。
2.5. [mozc git repo](https://github.com/google/mozc) を git clone するか [](https://github.com/google/mozc/blob/master/src/protocol/config.proto) を直接ローカル環境にダウンロードする。
2.6. 以下のコマンドにより `config1.db` をテキストファイルに変換する (以下のコマンドでは `$HOME/src/` 以下に mozc git repo が clone されている): 
```
cat $HOME/.mozc/config1.db | protoc --proto_path=$HOME/src/mozc/src/protocol --decode "mozc.config.Config" mozc/src/protocol/config.proto > $HOME/.mozc.config1.txt
```
2.7. 変換されたテキストファイルに以下のような行を追加する (以下の例では 50ms が同時打鍵入力判定のタイムアウトになる):
```
composing_timeout_threshold_msec: 50
```
2.8. 以下のコマンドによりテキストファイルをバイナリファイルに変換し直す:
```
cat $HOME/.mozc.config1.txt | protoc --proto_path=mozc/src/protocol --encode "mozc.config.Config" mozc/src/protocol/config.proto > $HOME/.mozc/config1.db
```

